<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>El Tío Viruelas</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Rock+Salt&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
  margin:0;
  background:#111;
  font-family:'Rock Salt',cursive;
  color:#C88713;
  text-align:center;
  overflow-x:hidden;
}

header{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:20px;
  margin-top:3vh;
}

.logo-moneda{
  width:40%;
  max-width:180px;
  aspect-ratio:1/1;
  border-radius:50%;
  overflow:hidden;
  border:4px solid #C88713;
  background:radial-gradient(circle at 35% 35%,#2a1f0a,#533b14,#2a1f0a);
}

.logo-moneda img{
  width:100%;
  height:100%;
  object-fit:cover;
}

header h1{
  font-size:clamp(2rem,4vw,5rem);
  margin:0;
}

/* TOCADISCOS */
.tocadiscos{
  position:relative;
  width:clamp(300px,40vw,450px);
  height:clamp(300px,40vw,450px);
  margin:5vh auto;
}

.vinilo{
  width:100%;
  height:100%;
  border-radius:50%;
  background:repeating-radial-gradient(circle,#000 0px,#111 2px,#000 4px);
  display:flex;
  align-items:center;
  justify-content:center;
  animation:girar 16s linear infinite;
}

.vinilo.rapido{ animation:girar 8s linear infinite; }

@keyframes girar{
  from{transform:rotate(0deg);}
  to{transform:rotate(360deg);}
}

.galleta{
  width:40%;
  height:40%;
  border-radius:50%;
  object-fit:cover;
  border:4px solid #C88713;
  animation:girar 16s linear infinite;
}

.galleta.rapido{ animation:girar 8s linear infinite; }

.agujero{
  position:absolute;
  width:5%;
  height:5%;
  background:#000;
  border-radius:50%;
}

.brazo{
  position:absolute;
  top:-5%;
  right:-10%;
  width:40%;
  transform-origin:top right;
  transition:transform 1s ease;
  z-index:10;
}

.brazo.activo{
  transform:rotate(20deg) translate(-10%,20%);
}

/* GALERIA */
.galeria{
  display:flex;
  gap:20px;
  overflow-x:auto;
  padding:20px;
  justify-content:center;
}

.galeria img{
  width:clamp(100px,15vw,180px);
  height:clamp(115px,17vw,200px);
  object-fit:cover;
  border-radius:5px;
  cursor:pointer;
  border:3px solid #000;
  box-shadow:2px 2px 8px rgba(0,0,0,.7);
  transition:.3s;
}

.galeria img:nth-child(odd){transform:rotate(-6deg);}
.galeria img:nth-child(even){transform:rotate(6deg);}
.galeria img:hover{transform:scale(1.05) rotate(0deg);}

/* CONTROLES */
.controles{
  display:flex;
  gap:15px;
  justify-content:center;
  margin-top:20px;
}

.controles button{
  width:50px;
  height:50px;
  border-radius:50%;
  border:2px solid #C88713;
  background:#222;
  color:#C88713;
  font-size:1.3rem;
  cursor:pointer;
}

.controles button:hover{
  background:#C88713;
  color:#111;
}

/* VU METER */
.vu-container{
  width:300px;
  height:120px;
  margin:30px auto;
  background:#222;
  border:2px solid #C88713;
}

#vu{
  width:100%;
  height:100%;
}

/* INFO */
#tiempo{
  color:#eee;
  font-family:sans-serif;
  margin-top:10px;
}

#info-disco{
  margin:15px auto;
  max-width:600px;
  background:#222;
  padding:15px;
  border-radius:10px;
  white-space:pre-line;
}
</style>
</head>

<body>

<header>
  <div class="logo-moneda">
    <img src="img/logo.jpeg">
  </div>
  <h1>El Tío Viruelas</h1>
</header>

<div class="tocadiscos">
  <img src="img/tocadiscos.png" class="brazo" id="brazo">
  <div class="vinilo" id="vinilo">
    <img id="galleta" class="galleta" src="img/logo.jpeg">
    <div class="agujero"></div>
  </div>
</div>

<div class="vu-container">
  <canvas id="vu"></canvas>
</div>

<div class="galeria">
  <img src="img/Vol I.jpg" data-img="img/Vol I.jpg" data-song="audio/El camino largo.mp3" data-info="info/Vol I.txt">
  <img src="img/Vol II.jpg" data-img="img/Vol II.jpg" data-song="audio/adios.mp3" data-info="info/Vol II.txt">
</div>

<audio id="player"></audio>

<div class="controles">
  <button onclick="playSong()"><i class="fas fa-play"></i></button>
  <button onclick="pauseSong()"><i class="fas fa-pause"></i></button>
  <button onclick="stopSong()"><i class="fas fa-stop"></i></button>
  <button onclick="volDown()"><i class="fas fa-volume-down"></i></button>
  <button onclick="volUp()"><i class="fas fa-volume-up"></i></button>
</div>

<div id="tiempo">0:00 / 0:00</div>
<div id="info-disco">Selecciona un disco.</div>

<script>
const player=document.getElementById('player');
const vinilo=document.getElementById('vinilo');
const galleta=document.getElementById('galleta');
const brazo=document.getElementById('brazo');
const info=document.getElementById('info-disco');
const tiempo=document.getElementById('tiempo');

/* TIEMPO */
function fmt(t){
 if(isNaN(t)) return '0:00';
 const m=Math.floor(t/60);
 const s=Math.floor(t%60);
 return `${m}:${String(s).padStart(2,'0')}`;
}
player.ontimeupdate=()=>tiempo.textContent=`${fmt(player.currentTime)} / ${fmt(player.duration)}`;

/* PORTADAS */
document.querySelectorAll('.galeria img').forEach(p=>{
 p.onclick=async()=>{
  galleta.src=p.dataset.img;
  vinilo.classList.add('rapido');
  galleta.classList.add('rapido');
  brazo.classList.add('activo');

  player.src=p.dataset.song;
  await player.play();

  const txt=await fetch(p.dataset.info).then(r=>r.text());
  info.textContent=txt;
 };
});

/* CONTROLES */
function playSong(){player.play();}
function pauseSong(){player.pause();}
function stopSong(){player.pause();player.currentTime=0;}
function volUp(){player.volume=Math.min(1,player.volume+.1);}
function volDown(){player.volume=Math.max(0,player.volume-.1);}

/* VU METER */
const canvas=document.getElementById('vu');
const ctx=canvas.getContext('2d');
canvas.width=300;
canvas.height=120;

const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
const src=audioCtx.createMediaElementSource(player);
const analyser=audioCtx.createAnalyser();
analyser.fftSize=64;
src.connect(analyser);
analyser.connect(audioCtx.destination);

const data=new Uint8Array(analyser.frequencyBinCount);

function drawVU(){
 requestAnimationFrame(drawVU);
 analyser.getByteFrequencyData(data);
 ctx.clearRect(0,0,300,120);
 for(let i=0;i<20;i++){
  const v=data[i]/255;
  ctx.fillStyle=v>.6?'#f00':v>.3?'#ff0':'#0f0';
  ctx.fillRect(10+i*14,110-v*100,10,v*100);
 }
}
drawVU();
</script>

</body>
</html>
